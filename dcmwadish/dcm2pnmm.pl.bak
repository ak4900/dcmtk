#!/usr/bin/perl

use CGI;

$query = CGI->new;


my $input = $query->param('file');
my $output;

open($output, "E:\\GitViews\\dcmtk\\dcmwadish\\dcm2pnm.exe +on +Wh 5 " . $input . " | ");

use constant BUFFER_SIZE => 4096;

my $buffer = "";

print "Content-type: image/png \n";
print "Cache-Control: private, max-age=3600\n";
print "\n";
binmode STDOUT;

while ($output, read( $output, $buffer, 4096) ) {
    print $buffer;
}

<>; #pause